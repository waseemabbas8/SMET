(function(n){"use strict";n.fn.editableAriaShim=function(){return this.attr({role:"button",tabindex:0}),this};n.fn.editable=function(t,i){if("disable"===t){n(this).data("disabled.editable",!0);return}if("enable"===t){n(this).data("disabled.editable",!1);return}if("destroy"===t){n(this).unbind(n(this).data("event.editable")).removeData("disabled.editable").removeData("event.editable");return}var r=n.extend({},n.fn.editable.defaults,{target:t},i),e=n.editable.types[r.type].plugin||function(){},o=n.editable.types[r.type].submit||function(){},s=n.editable.types[r.type].buttons||n.editable.types.defaults.buttons,h=n.editable.types[r.type].content||n.editable.types.defaults.content,c=n.editable.types[r.type].element||n.editable.types.defaults.element,u=n.editable.types[r.type].reset||n.editable.types.defaults.reset,l=n.editable.types[r.type].destroy||n.editable.types.defaults.destroy,f=r.callback||function(){},a=r.intercept||function(n){return n},v=r.onedit||function(){},y=r.onsubmit||function(){},p=r.onreset||function(){},w=r.onerror||u,b=r.before||!1;return r.tooltip&&n(this).attr("title",r.tooltip),this.each(function(){var i=this;if(n(this).data("event.editable",r.event),n.trim(n(this).html())||n(this).html(r.placeholder),"destroy"===t){l.apply(n(this).find("form"),[r,i]);return}n(this).bind(r.event,function(t){var l,p,k,b,g,d,nt;if(!0!==n(this).data("disabled.editable")&&t.which!==9&&!i.editing&&!1!==v.apply(this,[r,i,t])){if(r.before&&jQuery.isFunction(r.before))r.before();else if(r.before&&!jQuery.isFunction(r.before))throw"The 'before' option needs to be provided as a function!";t.preventDefault();t.stopPropagation();r.tooltip&&n(i).removeAttr("title");n(this).html().toLowerCase().replace(/(;|"|\/)/g,"")===r.placeholder.toLowerCase().replace(/(;|"|\/)/g,"")&&n(this).html("");i.editing=!0;i.revert=n(i).text();n(i).html("");l=n("<form />");r.cssclass&&("inherit"===r.cssclass?l.attr("class",n(i).attr("class")):l.attr("class",r.cssclass));r.style&&("inherit"===r.style?(l.attr("style",n(i).attr("style")),l.css("display",n(i).css("display"))):l.attr("style",r.style));r.label&&l.append("<label>"+r.label+"<\/label>");r.formid&&l.attr("id",r.formid);p=c.apply(l,[r,i]);r.inputcssclass&&("inherit"===r.inputcssclass?p.attr("class",n(i).attr("class")):p.attr("class",r.inputcssclass));g=!1;r.loadurl?(b=i.setTimeout(function(){p.disabled=!0},100),n(i).html(r.loadtext),d={},d[r.id]=i.id,n.isFunction(r.loaddata)?n.extend(d,r.loaddata.apply(i,[i.revert,r])):n.extend(d,r.loaddata),n.ajax({type:r.loadtype,url:r.loadurl,data:d,async:!1,cache:!1,success:function(n){i.clearTimeout(b);k=n;p.disabled=!1}})):r.data?(k=r.data,n.isFunction(r.data)&&(k=r.data.apply(i,[i.revert,r]))):k=i.revert;h.apply(l,[k,r,i]);p.attr("name",r.name);r.width!=="none"&&(nt=r.width-(p.outerWidth(!0)-r.width),p.width(nt));s.apply(l,[r,i]);r.showfn&&n.isFunction(r.showfn)&&l.hide();n(i).html("");n(i).append(l);r.showfn&&n.isFunction(r.showfn)&&r.showfn(l);e.apply(l,[r,i]);l.find(":input:visible:enabled:first").focus();r.select&&p.select();n(this).keydown(function(n){n.which===27&&(n.preventDefault(),u.apply(l,[r,i]))});"cancel"===r.onblur?p.blur(function(){b=i.setTimeout(function(){u.apply(l,[r,i])},500)}):"submit"===r.onblur?p.blur(function(){b=i.setTimeout(function(){l.submit()},200)}):n.isFunction(r.onblur)&&p.blur(function(){!1===r.onblur.apply(i,[p.val(),r,l])&&u.apply(l,[r,i])});l.submit(function(t){var h,e,u,s;return(t.preventDefault(),t.stopPropagation(),g)?!1:(g=!0,b&&i.clearTimeout(b),!1!==y.apply(l,[r,i])&&!1!==o.apply(l,[r,i])&&(n.isFunction(r.target)?(h=function(t){n(i).html(t);i.editing=!1;f.apply(i,[i.innerHTML,r]);n.trim(n(i).html())||n(i).html(r.placeholder)},e=r.target.apply(i,[p.val(),r,h]),!1!==e&&undefined!==e&&h(e)):(u={},u[r.name]=p.val(),u[r.id]=i.id,n.isFunction(r.submitdata)?n.extend(u,r.submitdata.apply(i,[i.revert,r,u])):n.extend(u,r.submitdata),"PUT"===r.method&&(u._method="put"),n(i).html(r.indicator),s={type:"POST",data:u,dataType:"html",url:r.target,success:function(t,e){t=a.apply(i,[t,e]);s.dataType==="html"&&n(i).html(t);i.editing=!1;f.apply(i,[t,r,u]);n.trim(n(i).html())||n(i).html(r.placeholder)},error:function(n){w.apply(l,[r,i,n])}},n.extend(s,r.ajaxoptions),n.ajax(s))),n(i).attr("title",r.tooltip),!1)})}});i.reset=function(t){i.editing&&!1!==p.apply(t,[r,i])&&(n(i).html(i.revert),i.editing=!1,n.trim(n(i).html())||n(i).html(r.placeholder),r.tooltip&&n(i).attr("title",r.tooltip))};i.destroy=function(t){n(i).unbind(n(i).data("event.editable")).removeData("disabled.editable").removeData("event.editable");i.clearTimeouts();i.editing&&u.apply(t,[r,i])};i.clearTimeout=function(t){var r=n(i).data("timeouts"),u;clearTimeout(t);r&&(u=r.indexOf(t),u>-1?(r.splice(u,1),r.length<=0&&n(i).removeData("timeouts")):console.warn("jeditable clearTimeout could not find timeout "+t))};i.clearTimeouts=function(){var t=n(i).data("timeouts"),r,u;if(t){for(r=0,u=t.length;r<u;++r)clearTimeout(t[r]);t.length=0;n(i).removeData("timeouts")}};i.setTimeout=function(t,r){var u=n(i).data("timeouts"),f=setTimeout(function(){t();i.clearTimeout(f)},r);return u||(u=[],n(i).data("timeouts",u)),u.push(f),f}})};var t=function(n){var t=document.createElement("input");return t.setAttribute("type",n),t.type!=="text"?n:"text"};n.editable={types:{defaults:{element:function(){var t=n('<input type="hidden"><\/input>');return n(this).append(t),t},content:function(t){n(this).find(":input:first").val(t)},reset:function(n,t){t.reset(this)},destroy:function(n,t){t.destroy(this)},buttons:function(t,i){var f=this,r,u;t.submit&&(t.submit.match(/>$/)?r=n(t.submit).click(function(){r.attr("type")!=="submit"&&f.submit()}):(r=n('<button type="submit" />'),r.html(t.submit),t.submitcssclass&&r.addClass(t.submitcssclass)),n(this).append(r));t.cancel&&(t.cancel.match(/>$/)?u=n(t.cancel):(u=n('<button type="cancel" />'),u.html(t.cancel),t.cancelcssclass&&u.addClass(t.cancelcssclass)),n(this).append(u),n(u).click(function(){var r;return r=n.isFunction(n.editable.types[t.type].reset)?n.editable.types[t.type].reset:n.editable.types.defaults.reset,r.apply(f,[t,i]),!1}))}},text:{element:function(t){var i=n("<input />").attr({autocomplete:"off",list:t.list,maxlength:t.maxlength,pattern:t.pattern,placeholder:t.placeholder,tooltip:t.tooltip,type:"text"});return t.width!=="none"&&i.css("width",t.width),t.height!=="none"&&i.css("height",t.height),t.size&&i.attr("size",t.size),t.maxlength&&i.attr("maxlength",t.maxlength),n(this).append(i),i}},textarea:{element:function(t){var i=n("<textarea><\/textarea>");return t.rows?i.attr("rows",t.rows):t.height!=="none"&&i.height(t.height),t.cols?i.attr("cols",t.cols):t.width!=="none"&&i.width(t.width),t.maxlength&&i.attr("maxlength",t.maxlength),n(this).append(i),i}},select:{element:function(t){var i=n("<select />");return t.multiple&&i.attr("multiple","multiple"),n(this).append(i),i},content:function(t,i,r){var e,f,u,s,o,h,c;e=String===t.constructor?JSON.parse(t):t;f=[];for(u in e)f.push([u,e[u]]);for(i.sortselectoptions&&f.sort(function(n,t){return n=n[1],t=t[1],n<t?-1:n>t?1:0}),o=0;o<f.length;o++)(u=f[o][0],h=f[o][1],e.hasOwnProperty(u))&&u!=="selected"&&(s=n("<option />").val(u).append(h),(e.selected===u||u===n.trim(r.revert))&&n(s).prop("selected","selected"),n(this).find("select").append(s));i.submit||(c=this,n(this).find("select").change(function(){c.submit()}))}},number:{element:function(i){var r=n("<input />").attr({maxlength:i.maxlength,placeholder:i.placeholder,min:i.min,max:i.max,step:i.step,tooltip:i.tooltip,type:t("number")});return i.width!=="none"&&r.css("width",i.width),n(this).append(r),r}},email:{element:function(i){var r=n("<input />").attr({maxlength:i.maxlength,placeholder:i.placeholder,tooltip:i.tooltip,type:t("email")});return i.width!=="none"&&r.css("width",i.width),n(this).append(r),r}},url:{element:function(i){var r=n("<input />").attr({maxlength:i.maxlength,pattern:i.pattern,placeholder:i.placeholder,tooltip:i.tooltip,type:t("url")});return i.width!=="none"&&r.css("width",i.width),n(this).append(r),r}}},addInputType:function(t,i){n.editable.types[t]=i}};n.fn.editable.defaults={name:"value",id:"id",type:"text",width:"auto",height:"auto",event:"click.editable keydown.editable",onblur:"cancel",tooltip:"Click to edit",loadtype:"GET",loadtext:"Loading...",placeholder:"Click to edit",sortselectoptions:!1,loaddata:{},submitdata:{},ajaxoptions:{}}})(jQuery);